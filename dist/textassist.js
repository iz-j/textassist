/*!
 * Text Assist
 * 
 * version: 0.1
 * Copyright (c) 2015 iz-j
 */
var TextAssist=function(e,t){"use strict";function n(){w=document.createElement("div"),k=document.createElement("ul"),k.tabIndex=-1,k.style.display="none",v(k,D),T.ulClassName?k.className=T.ulClassName:v(k,W),w.appendChild(k),L=document.createElement("div"),v(L,Q),w.appendChild(L),document.body.appendChild(w)}function a(e){switch(e.keyCode){case 8:m()&&(S?i():x());break;case 9:break;case 13:E?(e.preventDefault(),h()):x();break;case 27:x();break;case 32:e.ctrlKey?(e.preventDefault(),m()?x():i()):x();break;case 38:E&&(e.preventDefault(),u());break;case 40:E&&(e.preventDefault(),d());break;case 37:case 39:m()&&i();break;case 33:case 34:case 35:case 36:x();break;default:m()&&i()}}function l(e){e.relatedTarget!==k&&x()}function o(e){for(var t=e.target;t&&t!==k;){if("A"===e.target.tagName&&t.dataset.value){H=t,h();break}t=t.parentNode}}function i(){M&&clearTimeout(M),M=setTimeout(s,T.delayMills)}function s(){for(E=!1,H=null;k.lastChild;)k.removeChild(k.lastChild);var e=document.createElement("li");e.innerHTML=T.loadingHTML,k.appendChild(e);var t=g();k.style.left=t.left+"px",k.style.top=t.top+"px",k.style.display="block",r(),T.find(S,c)}function r(){var e=N.value.slice(0,N.selectionStart),t=e.match(j);S=t?t[2]:""}function c(e){return e&&0!==e.length?(k.removeChild(k.firstChild),e.forEach(function(e){var t=document.createElement("li"),n=document.createElement("a");t.appendChild(n),T.liClassName&&(t.className=T.liClassName),T.anchorClassName?n.className=T.anchorClassName:v(n,A),n.dataset.value=e,n.innerHTML=T.item(e,S),k.appendChild(t),H||(f(n),k.scrollTop=0)}),void(E=!0)):void(k.firstChild.innerHTML=T.noneHTML)}function d(){H.parentNode.nextSibling&&f(H.parentNode.nextSibling.firstChild)}function u(){H.parentNode.previousSibling&&f(H.parentNode.previousSibling.firstChild)}function f(e){T.anchorClassName||(H&&v(H,A),v(e,q)),T.activeClassName&&(H&&H.parentNode.classList.remove(T.activeClassName),e.parentNode.classList.add(T.activeClassName)),H=e,p()}function p(){var e=k.scrollTop,t=k.offsetHeight+k.scrollTop-H.parentNode.offsetHeight;H.offsetTop<e?k.scrollTop=H.offsetTop:H.offsetTop>t&&(k.scrollTop=k.scrollTop+(H.offsetTop-t))}function h(){var e=H.dataset.value,t=N.value.slice(0,N.selectionStart),n=N.value.slice(N.selectionStart,N.value.length);t=t.replace(new RegExp(S+"$"),e),N.value=t+n,N.focus(),N.selectionStart=t.length,N.selectionEnd=t.length,x()}function v(e,t){Object.keys(t).forEach(function(n){e.style[n]=t[n]})}function m(){return"none"!==k.style.display}function g(){var e=document.defaultView.getComputedStyle(N,"");R.forEach(function(t){L.style[t]=e[t]}),L.style.overflow="auto";var t=N.value,n=t.slice(0,N.selectionStart),a=t.slice(N.selectionStart,N.selectionEnd),l=t.slice(N.selectionEnd,t.length);a||(a="|"),L.innerHTML=y(n)+'<span class="textassist-caret">'+y(a)+"</span>"+y(l),L.scrollLeft=N.scrollLeft,L.scrollTop=N.scrollTop;var o=L.querySelector(".textassist-caret"),i=b(N),s=b(L),r=b(o);return{left:i.left+(r.left-s.left),top:i.top+(r.top-s.top+o.offsetHeight)}}function y(e){return e.replace(/[&"<>]/g,function(e){return B[e]}).replace(/\r?\n/g,"<br />")}function b(e){var t=0,n=0;do t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent;while(e);return{top:t,left:n}}function x(){k.style.display="none",E=!1}function C(){N.removeEventListener("keydown",a),N.removeEventListener("blur",l),k.removeEventListener("click",o),N=null,T=null,w.remove(),w=null,k=null,L=null,H=null}var T={find:function(e,t){throw'"find" function is required!'},ulClassName:null,liClassName:null,anchorClassName:null,activeClassName:null,item:function(e,t){return e},loadingHTML:'<a href="javasript:void(0)">Loading...</a>',noneHTML:'<a href="javasript:void(0)">No items...</a>',delayMills:200};Object.keys(T).forEach(function(e){e in t&&(T[e]=t[e])});var N=e,w=null,k=null,L=null,E=!1,S=null,H=null,M=null,j=/(^|\s)([^\s]*)$/,D={position:"absolute",overflowX:"hidden",overflowY:"auto"},W={"list-style":"none",border:"solid 1px silver",background:"white",boxShadow:"0px 3px 6px gray",padding:"4px",margin:"2px",maxHeight:"120px"},A={whiteSpace:"nowrap",cursor:"default",display:"block",padding:"2px 20px 2px 4px",background:"white",color:"black"},q={background:"gray",color:"white"},Q={visibility:"hidden",position:"absolute",left:"0px",top:"0px",whiteSpace:"nowrap"};N.wrap="off",n(),N.addEventListener("keydown",a),N.addEventListener("blur",l),k.addEventListener("click",o);var R=["width","height","borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","fontFamily","fontSize","fontStyle","fontVariant","fontWeight","letterSpacing","wordSpacing","lineHeight","textDecoration","paddingBottom","paddingLeft","paddingRight","paddingTop"],B={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"};return{hide:x,destroy:C}};window.jQuery&&!function(e){var t=function(t){return this.each(function(){var n=e(this),a=n.data("textassist");a||n.data("textassist",new TextAssist(this,t))})},n={destroy:function(){return this.each(function(){var t=e(this),n=t.data("textassist");n&&(n.destroy(),t.removeData("textassist"))})}};e.fn.textassist=function(a){return n[a]?n[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?(e.error("Method "+a+" does not exist on jQuery.textassist"),this):t.apply(this,arguments)}}(jQuery);